{% extends "base.html" %}

{% block title %}Dashboard - RelaticPanama{% endblock %}

{% block page_content %}
{% block content %}
<div class="canvas-dashboard">
    <!-- Título de Servicios -->
    <div class="text-center mb-4">
        <h2 class="h4 mb-0">Servicios Disponibles</h2>
        <p class="text-muted small">Accesos directos a los servicios de RELATIC</p>
    </div>
    
    <!-- Información General del Dashboard -->
    <div class="dashboard-info-cards mb-4">
        <div class="row g-3">
            <!-- Bienvenida -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="service-icon-circle bg-primary me-3" style="width: 50px; height: 50px; font-size: 20px;">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <h6 class="mb-0 text-muted small">Bienvenido</h6>
                                <h5 class="mb-0">{{ current_user.first_name }} {{ current_user.last_name }}</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Días desde inicio -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="service-icon-circle bg-success me-3" style="width: 50px; height: 50px; font-size: 20px;">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div>
                                <h6 class="mb-0 text-muted small">Días activo</h6>
                                <h5 class="mb-0">
                                    {% if days_active is not none %}
                                        {{ days_active }} día{% if days_active != 1 %}s{% endif %}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Días restantes -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="service-icon-circle {% if days_remaining is not none and days_remaining <= 30 %}bg-danger{% else %}bg-warning{% endif %} me-3" style="width: 50px; height: 50px; font-size: 20px;">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <h6 class="mb-0 text-muted small">Días restantes</h6>
                                <h5 class="mb-0">
                                    {% if days_remaining is not none %}
                                        {% if days_remaining > 0 %}
                                            {{ days_remaining }} día{% if days_remaining != 1 %}s{% endif %}
                                        {% else %}
                                            <span class="text-danger">Vencida</span>
                                        {% endif %}
                                    {% else %}
                                        Sin membresía
                                    {% endif %}
                                </h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Iconos Circulares de Servicios - Accesos Directos -->
    <div class="services-icons-container mb-5">
        <div class="row g-4">
            <!-- Primera fila: Servicios Básicos -->
            <div class="col-12">
                <h5 class="text-muted mb-3 small text-uppercase">Servicios Básicos</h5>
                <div class="services-icons-row d-flex gap-3 justify-content-start flex-wrap">
                    <!-- Revistas -->
                    <a href="https://relaticpanama.org/_journals/" target="_blank" rel="noopener noreferrer" class="service-icon-item text-decoration-none" data-service="revistas">
                        <div class="service-icon-circle bg-purple">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        <span class="service-icon-label">Revistas</span>
                    </a>
                    <!-- Carteles -->
                    <a href="https://relaticpanama.org/_posters/" target="_blank" rel="noopener noreferrer" class="service-icon-item text-decoration-none" data-service="carteles">
                        <div class="service-icon-circle bg-orange">
                            <i class="fas fa-image"></i>
                        </div>
                        <span class="service-icon-label">Carteles</span>
                    </a>
                    <!-- Libros Digitales -->
                    <a href="https://relaticpanama.org/_books/index.php/edrp/catalog" target="_blank" rel="noopener noreferrer" class="service-icon-item text-decoration-none" data-service="libros">
                        <div class="service-icon-circle bg-red">
                            <i class="fas fa-book"></i>
                        </div>
                        <span class="service-icon-label">Libros Digitales</span>
                    </a>
                </div>
            </div>
            
            <!-- Segunda fila: Servicios PRO -->
            <div class="col-12">
                <h5 class="text-muted mb-3 small text-uppercase">Servicios PRO</h5>
                <div class="services-icons-row d-flex gap-3 justify-content-start flex-wrap">
                    <!-- Aprendizaje Continuo -->
                    <a href="https://dev.relatic.org/detalles-aprendizaje" target="_blank" rel="noopener noreferrer" class="service-icon-item text-decoration-none" data-service="aprendizaje">
                        <div class="service-icon-circle bg-pink">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <span class="service-icon-label">Aprendizaje</span>
                    </a>
                    <!-- Propiedad Intelectual -->
                    <a href="https://dev.relatic.org/detalles-propiedad-intelectual" target="_blank" rel="noopener noreferrer" class="service-icon-item text-decoration-none" data-service="propiedad">
                        <div class="service-icon-circle bg-purple">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <span class="service-icon-label">Propiedad IP</span>
                    </a>
                    <!-- Formateo Rápido -->
                    <a href="https://dev.relatic.org/detalles-formateo-rapido" target="_blank" rel="noopener noreferrer" class="service-icon-item text-decoration-none" data-service="formateo">
                        <div class="service-icon-circle bg-teal">
                            <i class="fas fa-pen-fancy"></i>
                        </div>
                        <span class="service-icon-label">Formateo</span>
                    </a>
                    <!-- Correo y Suites -->
                    <a href="{{ url_for('services') }}#correo" class="service-icon-item text-decoration-none" data-service="correo">
                        <div class="service-icon-circle bg-green">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <span class="service-icon-label">Correo</span>
                    </a>
                    <!-- Apoyo Colaborativo -->
                    <a href="{{ url_for('services') }}#apoyo" class="service-icon-item text-decoration-none" data-service="apoyo">
                        <div class="service-icon-circle bg-blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <span class="service-icon-label">Apoyo</span>
                    </a>
                    <!-- Difusión -->
                    <a href="{{ url_for('services') }}#difusion" class="service-icon-item text-decoration-none" data-service="difusion">
                        <div class="service-icon-circle bg-dark-blue">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <span class="service-icon-label">Difusión</span>
                    </a>
                    <!-- Foros -->
                    <a href="{{ url_for('foros') }}" class="service-icon-item text-decoration-none" data-service="foros">
                        <div class="service-icon-circle bg-indigo">
                            <i class="fas fa-comments"></i>
                        </div>
                        <span class="service-icon-label">Foros</span>
                    </a>
                    <!-- Grupos -->
                    <a href="{{ url_for('grupos') }}" class="service-icon-item text-decoration-none" data-service="grupos">
                        <div class="service-icon-circle bg-cyan">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <span class="service-icon-label">Grupos</span>
                    </a>
                    <!-- Citas -->
                    <a href="{{ url_for('appointments.appointments_home') }}" class="service-icon-item text-decoration-none" data-service="citas">
                        <div class="service-icon-circle bg-teal">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <span class="service-icon-label">Citas y Asesorías</span>
                    </a>
                </div>
            </div>
            
            <!-- Tercera fila: Servicios Premium -->
            <div class="col-12">
                <h5 class="text-muted mb-3 small text-uppercase">Servicios Premium</h5>
                <div class="services-icons-row d-flex gap-3 justify-content-start flex-wrap">
                    <!-- Bases de Datos -->
                    <a href="{{ url_for('services') }}#bases" class="service-icon-item text-decoration-none" data-service="bases">
                        <div class="service-icon-circle bg-brown">
                            <i class="fas fa-database"></i>
                        </div>
                        <span class="service-icon-label">Bases de Datos</span>
                    </a>
                    <!-- Eventos y Citas -->
                    <a href="{{ url_for('events.list_events') }}" class="service-icon-item text-decoration-none" data-service="eventos">
                        <div class="service-icon-circle bg-indigo">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <span class="service-icon-label">Eventos</span>
                    </a>
                    <!-- Ver Todos los Servicios -->
                    <a href="{{ url_for('services') }}" class="service-icon-item text-decoration-none" data-service="todos">
                        <div class="service-icon-circle bg-white">
                            <i class="fas fa-th-large"></i>
                        </div>
                        <span class="service-icon-label">Ver Todos</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección Recientes -->
    <div class="recent-section">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="recent-title">Recientes</h2>
            <button class="btn btn-link text-decoration-none">Ver todo</button>
        </div>
        <div class="recent-cards-container">
            <div class="recent-cards-scroll d-flex gap-3">
                <!-- Tarjeta 1 -->
                <div class="recent-card">
                    <div class="recent-card-header">
                        <i class="fas fa-lock text-muted"></i>
                        <span class="recent-card-privacy">Privado</span>
                    </div>
                    <div class="recent-card-preview bg-light">
                        <i class="fas fa-file-alt text-muted" style="font-size: 3rem;"></i>
                    </div>
                    <div class="recent-card-title">Documento 1</div>
                </div>
                <!-- Tarjeta 2 -->
                <div class="recent-card">
                    <div class="recent-card-header">
                        <i class="fas fa-lock text-muted"></i>
                        <span class="recent-card-privacy">Privado</span>
                    </div>
                    <div class="recent-card-preview bg-light">
                        <i class="fas fa-presentation text-muted" style="font-size: 3rem;"></i>
                    </div>
                    <div class="recent-card-title">Presentación 1</div>
                </div>
                <!-- Tarjeta 3 -->
                <div class="recent-card">
                    <div class="recent-card-header">
                        <i class="fas fa-lock text-muted"></i>
                        <span class="recent-card-privacy">Privado</span>
                    </div>
                    <div class="recent-card-preview bg-light">
                        <i class="fas fa-image text-muted" style="font-size: 3rem;"></i>
                    </div>
                    <div class="recent-card-title">Imagen 1</div>
                </div>
                <!-- Tarjeta 4 -->
                <div class="recent-card">
                    <div class="recent-card-header">
                        <i class="fas fa-lock text-muted"></i>
                        <span class="recent-card-privacy">Privado</span>
                    </div>
                    <div class="recent-card-preview bg-light">
                        <i class="fas fa-video text-muted" style="font-size: 3rem;"></i>
                    </div>
                    <div class="recent-card-title">Vídeo 1</div>
                </div>
                <!-- Tarjeta 5 -->
                <div class="recent-card">
                    <div class="recent-card-header">
                        <i class="fas fa-lock text-muted"></i>
                        <span class="recent-card-privacy">Privado</span>
                    </div>
                    <div class="recent-card-preview bg-light">
                        <i class="fas fa-file-pdf text-muted" style="font-size: 3rem;"></i>
                    </div>
                    <div class="recent-card-title">PDF 1</div>
                </div>
            </div>
        </div>
    </div>

    {% if current_user.is_admin %}
    <div class="admin-section mt-5">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="service-icon-circle bg-dark-blue me-3" style="width: 55px; height: 55px; font-size: 22px;">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div>
                        <h3 class="h5 mb-0">Panel de Administración</h3>
                        <small class="text-muted">Accesos rápidos disponibles solo para administradores</small>
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-md-3 col-sm-6">
                        <a href="{{ url_for('admin_dashboard') }}" class="card h-100 border-0 shadow-sm text-decoration-none text-dark admin-card-link">
                            <div class="card-body">
                                <i class="fas fa-tachometer-alt text-primary fa-2x mb-3"></i>
                                <h6 class="fw-bold mb-1">Panel General</h6>
                                <p class="text-muted small mb-0">Métricas y visión general</p>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <a href="{{ url_for('admin_users') }}" class="card h-100 border-0 shadow-sm text-decoration-none text-dark admin-card-link">
                            <div class="card-body">
                                <i class="fas fa-users text-success fa-2x mb-3"></i>
                                <h6 class="fw-bold mb-1">Usuarios</h6>
                                <p class="text-muted small mb-0">Gestión de cuentas</p>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <a href="{{ url_for('admin_memberships') }}" class="card h-100 border-0 shadow-sm text-decoration-none text-dark admin-card-link">
                            <div class="card-body">
                                <i class="fas fa-crown text-warning fa-2x mb-3"></i>
                                <h6 class="fw-bold mb-1">Membresías</h6>
                                <p class="text-muted small mb-0">Planes y estados</p>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <a href="{{ url_for('admin_events.admin_events_index') }}" class="card h-100 border-0 shadow-sm text-decoration-none text-dark admin-card-link">
                            <div class="card-body">
                                <i class="fas fa-calendar-alt text-danger fa-2x mb-3"></i>
                                <h6 class="fw-bold mb-1">Eventos</h6>
                                <p class="text-muted small mb-0">Eventos y citas RELATIC</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
// Agregar clase 'stuck' cuando el resumen de membresía esté fijo
document.addEventListener('DOMContentLoaded', function() {
    const membershipSummary = document.querySelector('.sticky-membership-summary');
    if (membershipSummary) {
        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach(entry => {
                    if (entry.intersectionRatio < 1) {
                        membershipSummary.classList.add('stuck');
                    } else {
                        membershipSummary.classList.remove('stuck');
                    }
                });
            },
            { threshold: [1] }
        );
        observer.observe(membershipSummary);
    }
});
</script>
{% endblock %}
{% endblock %}
